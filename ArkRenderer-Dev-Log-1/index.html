<!DOCTYPE html>
<html lang=en>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>ArkRenderer Dev Log 1 | Proton&#39;s Blog</title>
  <meta name="description" content="Wrapping Vertex Array Object &amp; Vertex Buffer ObjectTo start drawing something we have to first give OpenGL some input vertex data. These data are stored in GPU memory, which are managed via so cal">
<meta property="og:type" content="article">
<meta property="og:title" content="ArkRenderer Dev Log 1">
<meta property="og:url" content="https://proton991.github.io/ArkRenderer-Dev-Log-1/index.html">
<meta property="og:site_name" content="Cxy&#39;s Blog">
<meta property="og:description" content="Wrapping Vertex Array Object &amp; Vertex Buffer ObjectTo start drawing something we have to first give OpenGL some input vertex data. These data are stored in GPU memory, which are managed via so cal">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://proton991.github.io/ArkRenderer-Dev-Log-1/RenderingPipeline.png">
<meta property="article:published_time" content="2022-06-22T10:38:31.000Z">
<meta property="article:modified_time" content="2022-06-22T14:16:01.467Z">
<meta property="article:author" content="Cui Xinyu">
<meta property="article:tag" content="Renderer">
<meta property="article:tag" content="OpenGL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://proton991.github.io/ArkRenderer-Dev-Log-1/RenderingPipeline.png">
  <!-- Canonical links -->
  <link rel="canonical" href="https://proton991.github.io/ArkRenderer-Dev-Log-1/index.html">
  
    <link rel="alternate" href="/atom.xml" title="Cxy&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
    <link href="//cdn.jsdelivr.net/npm/katex@0.9.0/dist/katex.min.css" rel="stylesheet">
  
  
  
  
<meta name="generator" content="Hexo 5.4.0"></head>


<body class="main-center theme-black# 主题颜色 theme-black theme-blue theme-green theme-purple" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/proton991" target="_blank">
          <img class="img-circle img-rotate" src="/images/minions.jpeg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">Cui Xinyu</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">Farmer</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shanghai, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="Search" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="Type something..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">Home</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">Archives</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">Categories</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">Tags</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">Repository</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">About</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/proton991" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">Board</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>Welcome!</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">Categories</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Cpp/">Cpp</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Talk/">Talk</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/computer-graphics/">computer graphics</a><span class="category-list-count">6</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Tags</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenGL/" rel="tag">OpenGL</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Renderer/" rel="tag">Renderer</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vulkan/" rel="tag">Vulkan</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/algorithm/" rel="tag">algorithm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/" rel="tag">c++</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c-STL/" rel="tag">c++ STL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/computer-graphics/" rel="tag">computer-graphics</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ray-tracing/" rel="tag">ray-tracing</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/OpenGL/" style="font-size: 13.67px;">OpenGL</a> <a href="/tags/Renderer/" style="font-size: 14px;">Renderer</a> <a href="/tags/Vulkan/" style="font-size: 13.33px;">Vulkan</a> <a href="/tags/algorithm/" style="font-size: 13px;">algorithm</a> <a href="/tags/c/" style="font-size: 13px;">c++</a> <a href="/tags/c-STL/" style="font-size: 13px;">c++ STL</a> <a href="/tags/computer-graphics/" style="font-size: 13px;">computer-graphics</a> <a href="/tags/ray-tracing/" style="font-size: 13px;">ray-tracing</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">Archive</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/computer-graphics/">computer graphics</a>
              </p>
              <p class="item-title">
                <a href="/Ark-VkRenderer-Dev-Log-1/" class="title">Ark VkRenderer Dev Log 1</a>
              </p>
              <p class="item-date">
                <time datetime="2022-07-04T04:25:25.000Z" itemprop="datePublished">2022-07-04</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/computer-graphics/">computer graphics</a>
              </p>
              <p class="item-title">
                <a href="/Ark-VkRender-Dev-Log-0/" class="title">Ark VkRenderer Dev Log 0</a>
              </p>
              <p class="item-date">
                <time datetime="2022-07-03T09:21:10.000Z" itemprop="datePublished">2022-07-03</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/computer-graphics/">computer graphics</a>
              </p>
              <p class="item-title">
                <a href="/ArkRenderer-Dev-Log-1/" class="title">ArkRenderer Dev Log 1</a>
              </p>
              <p class="item-date">
                <time datetime="2022-06-22T10:38:31.000Z" itemprop="datePublished">2022-06-22</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/computer-graphics/">computer graphics</a>
              </p>
              <p class="item-title">
                <a href="/ArkRenderer-Dev-Log-0/" class="title">ArkRenderer Dev Log 0</a>
              </p>
              <p class="item-date">
                <time datetime="2022-06-17T09:32:03.000Z" itemprop="datePublished">2022-06-17</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/computer-graphics/">computer graphics</a>
              </p>
              <p class="item-title">
                <a href="/ArkRenderer-Project/" class="title">ArkRenderer Project</a>
              </p>
              <p class="item-date">
                <time datetime="2022-06-17T05:51:32.000Z" itemprop="datePublished">2022-06-17</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">Catalogue</h3>
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Wrapping-Vertex-Array-Object-amp-Vertex-Buffer-Object"><span class="toc-number">1.</span> <span class="toc-text">Wrapping Vertex Array Object &amp; Vertex Buffer Object</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Shader-Classes"><span class="toc-number">3.</span> <span class="toc-text">Shader Classes</span></a></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-ArkRenderer-Dev-Log-1" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      ArkRenderer Dev Log 1
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/ArkRenderer-Dev-Log-1/" class="article-date">
	  <time datetime="2022-06-22T10:38:31.000Z" itemprop="datePublished">2022-06-22</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/computer-graphics/">computer graphics</a>
  </span>

        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/tags/OpenGL/" rel="tag">OpenGL</a>, <a class="article-tag-link-link" href="/tags/Renderer/" rel="tag">Renderer</a>
  </span>


        

        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/ArkRenderer-Dev-Log-1/#comments" class="article-comment-link">Comments</a></span>
        
      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h2 id="Wrapping-Vertex-Array-Object-amp-Vertex-Buffer-Object"><a href="#Wrapping-Vertex-Array-Object-amp-Vertex-Buffer-Object" class="headerlink" title="Wrapping Vertex Array Object &amp; Vertex Buffer Object"></a>Wrapping Vertex Array Object &amp; Vertex Buffer Object</h2><p>To start drawing something we have to first give OpenGL some input vertex data. These data are stored in GPU memory, which are managed via so called <strong>vertex buffer objects(VBO)</strong>.</p>
<p><strong>A Vertex Array Object (or VAO)</strong> is an object that <strong>describes how the vertex attributes are stored in a Vertex Buffer Object (or VBO)</strong></p>
<p>Using such objects in OpenGL follows the pattern “Gen..&#x2F;Bind…&#x2F;..Enable(use)”, similar to a state machine. So we use OOP to wrap them together to make our code cleaner and improve readability.</p>
<p>A vertex attribute is <strong>an input variable to a shader that is supplied with per-vertex data</strong>. These variable can contain, for example, positions, normals or texture coordinates.</p>
<p>We use <code>GLVertexArray</code> </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GLVertexArray.h</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GLVertexArray</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">BufferType</span> :</span> <span class="keyword">int</span></span><br><span class="line">    &#123;</span><br><span class="line">        Array = GL_ARRAY_BUFFER,</span><br><span class="line">        Element = GL_ELEMENT_ARRAY_BUFFER</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">DrawMode</span> :</span> <span class="keyword">int</span></span><br><span class="line">    &#123;</span><br><span class="line">        Static = GL_STATIC_DRAW,</span><br><span class="line">        Dynamic = GL_DYNAMIC_DRAW,</span><br><span class="line">        Stream = GL_STREAM_DRAW</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span> <span class="keyword">noexcept</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">AttachBuffer</span><span class="params">(<span class="keyword">const</span> BufferType type, <span class="keyword">const</span> <span class="keyword">size_t</span> size,</span></span></span><br><span class="line"><span class="params"><span class="function">	                  <span class="keyword">const</span> DrawMode mode, <span class="keyword">const</span> <span class="keyword">void</span>* data)</span> <span class="keyword">noexcept</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Bind</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">noexcept</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">EnableAttribute</span><span class="params">(<span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> index, <span class="keyword">const</span> <span class="keyword">int</span> size,</span></span></span><br><span class="line"><span class="params"><span class="function">	                     <span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> offset, <span class="keyword">const</span> <span class="keyword">void</span>* data)</span> <span class="keyword">noexcept</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Delete</span><span class="params">()</span> <span class="keyword">noexcept</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> m_vao&#123;<span class="number">0</span>&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// GLVertexArray.cpp</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;GLVertexArray.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GLVertexArray::Init</span><span class="params">()</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">glGenVertexArrays</span>(<span class="number">1</span>, &amp;m_vao);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GLVertexArray::AttachBuffer</span><span class="params">(<span class="keyword">const</span> BufferType type, <span class="keyword">const</span> <span class="keyword">size_t</span> size,</span></span></span><br><span class="line"><span class="params"><span class="function">                                 <span class="keyword">const</span> DrawMode mode, <span class="keyword">const</span> <span class="keyword">void</span>* data)</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> buffer;</span><br><span class="line">    <span class="built_in">glGenBuffers</span>(<span class="number">1</span>, &amp;buffer);</span><br><span class="line">    <span class="built_in">glBindBuffer</span>(type, buffer);</span><br><span class="line">    <span class="built_in">glBufferData</span>(type, size, data, mode);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GLVertexArray::Bind</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">glBindVertexArray</span>(m_vao);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GLVertexArray::Delete</span><span class="params">()</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">glDeleteVertexArrays</span>(<span class="number">1</span>, &amp;m_vao);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GLVertexArray::EnableAttribute</span><span class="params">(<span class="keyword">const</span> <span class="keyword">unsigned</span> index, <span class="keyword">const</span> <span class="keyword">int</span> size,</span></span></span><br><span class="line"><span class="params"><span class="function">                                    <span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> offset,</span></span></span><br><span class="line"><span class="params"><span class="function">                                    <span class="keyword">const</span> <span class="keyword">void</span>* data)</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">glEnableVertexAttribArray</span>(index);</span><br><span class="line">    <span class="built_in">glVertexAttribPointer</span>(index, size, GL_FLOAT, GL_FALSE, offset, data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h2 id="Shader-Classes"><a href="#Shader-Classes" class="headerlink" title="Shader Classes"></a>Shader Classes</h2><p><strong>Shaders</strong> are little programs that rest on the GPU, which are run for each specific section of the graphics pipeline.</p>
<p>Below is the OpenGL rendering pipeline. There are many stages, each stage takes in input data and output data for next stage.</p>
<p><img src="/ArkRenderer-Dev-Log-1/RenderingPipeline.png" alt="RenderingPipeline"></p>
<p>At the beginning, we will only use <strong>vertex shader</strong> and <strong>fragment shader</strong>. We use a <code>ShaderStage</code> struct to store each shader stage:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> Graphics</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">const</span> std::unordered_map&lt;std::string, <span class="keyword">int</span>&gt; TYPE2_GL_ENUM&#123;</span><br><span class="line">        &#123;<span class="string">&quot;vertex&quot;</span>, GL_VERTEX_SHADER&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;fragment&quot;</span>, GL_FRAGMENT_SHADER&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;geometry&quot;</span>, GL_GEOMETRY_SHADER&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;compute&quot;</span>, GL_COMPUTE_SHADER&#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ShaderStage</span></span></span><br><span class="line"><span class="class">	&#123;</span></span><br><span class="line">        <span class="built_in">ShaderStage</span>() <span class="keyword">noexcept</span> = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">ShaderStage</span>(<span class="keyword">const</span> std::string&amp; path, <span class="keyword">const</span> std::string&amp; type) :</span><br><span class="line">            <span class="built_in">m_filePath</span>(path), <span class="built_in">m_type</span>(type)</span><br><span class="line">        &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        std::string m_filePath;</span><br><span class="line">        std::string m_type;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;; <span class="comment">// namespace Graphics</span></span><br></pre></td></tr></table></figure>

<p>We manipulate shaders via id, which is the return value of <code>glCreateShader()</code>.  Uniform variables allow us to pass data to our shaders, the difference between attribute and uniform variable is that attribute variables contain data which is vertex specific so they are reloaded with a new value from the vertex buffer for each shader invocation while the value of uniform variables remains constant across the entire draw call. Here’s how we define a Shader program:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GLShaderProgram</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::unordered_map&lt;std::string, <span class="keyword">int</span>&gt; m_uniforms;</span><br><span class="line">    GLuint m_programId&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    std::string m_programName;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GetUniforms</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">GLShaderProgram</span>(<span class="keyword">const</span> std::string&amp; programName, <span class="keyword">const</span> GLuint programId);</span><br><span class="line">    ~<span class="built_in">GLShaderProgram</span>();</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Bind</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">DeleteProgram</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">    <span class="function">GLShaderProgram&amp; <span class="title">SetUniformi</span><span class="params">(<span class="keyword">const</span> std::string&amp; uniformName,</span></span></span><br><span class="line"><span class="params"><span class="function">	                             <span class="keyword">const</span> <span class="keyword">int</span> value)</span></span>;</span><br><span class="line">    <span class="function">GLShaderProgram&amp; <span class="title">SetUniformf</span><span class="params">(<span class="keyword">const</span> std::string&amp; uniformName,</span></span></span><br><span class="line"><span class="params"><span class="function">	                             <span class="keyword">const</span> <span class="keyword">float</span> value)</span></span>;</span><br><span class="line">    <span class="function">GLShaderProgram&amp; <span class="title">SetUniform</span><span class="params">(<span class="keyword">const</span> std::string&amp; uniformName,</span></span></span><br><span class="line"><span class="params"><span class="function">	                            <span class="keyword">const</span> glm::ivec2&amp; value)</span></span>;</span><br><span class="line">    <span class="function">GLShaderProgram&amp; <span class="title">SetUniform</span><span class="params">(<span class="keyword">const</span> std::string&amp; uniformName,</span></span></span><br><span class="line"><span class="params"><span class="function">	                            <span class="keyword">const</span> glm::vec2&amp; value)</span></span>;</span><br><span class="line">    <span class="function">GLShaderProgram&amp; <span class="title">SetUniform</span><span class="params">(<span class="keyword">const</span> std::string&amp; uniformName,</span></span></span><br><span class="line"><span class="params"><span class="function">	                            <span class="keyword">const</span> glm::vec3&amp; value)</span></span>;</span><br><span class="line">    <span class="function">GLShaderProgram&amp; <span class="title">SetUniform</span><span class="params">(<span class="keyword">const</span> std::string&amp; uniformName,</span></span></span><br><span class="line"><span class="params"><span class="function">	                            <span class="keyword">const</span> glm::vec4&amp; value)</span></span>;</span><br><span class="line">    <span class="function">GLShaderProgram&amp; <span class="title">SetUniform</span><span class="params">(<span class="keyword">const</span> std::string&amp; uniformName,</span></span></span><br><span class="line"><span class="params"><span class="function">	                            <span class="keyword">const</span> glm::mat3x3&amp; value)</span></span>;</span><br><span class="line">    <span class="function">GLShaderProgram&amp; <span class="title">SetUniform</span><span class="params">(<span class="keyword">const</span> std::string&amp; uniformName,</span></span></span><br><span class="line"><span class="params"><span class="function">	                            <span class="keyword">const</span> glm::mat4x4&amp; value)</span></span>;</span><br><span class="line"></span><br><span class="line">    [[nodiscard]] <span class="function"><span class="keyword">auto</span> <span class="title">GetProgramName</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> m_programName; &#125;</span><br><span class="line">&#125;;</span><br><span class="line">GLShaderProgram::<span class="built_in">GLShaderProgram</span>(<span class="keyword">const</span> std::string&amp; programName,</span><br><span class="line">                                 <span class="keyword">const</span> GLuint programID):</span><br><span class="line">    <span class="built_in">m_programId</span>(programID), <span class="built_in">m_programName</span>(programName)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">GetUniforms</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GLShaderProgram::GetUniforms</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> total = <span class="number">-1</span>;</span><br><span class="line">    <span class="built_in">glGetProgramiv</span>(m_programId, GL_ACTIVE_UNIFORMS, &amp;total);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> i = <span class="number">0</span>; i &lt; total; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> nameLen = <span class="number">-1</span>, num = <span class="number">-1</span>;</span><br><span class="line">        GLenum type = GL_ZERO;</span><br><span class="line">        <span class="keyword">char</span> name[<span class="number">100</span>];</span><br><span class="line">        <span class="built_in">glGetActiveUniform</span>(m_programId, <span class="keyword">static_cast</span>&lt;GLuint&gt;(i),</span><br><span class="line">                           <span class="built_in"><span class="keyword">sizeof</span></span>(name) - <span class="number">1</span>, &amp;nameLen, &amp;num, &amp;type, name);</span><br><span class="line">        name[nameLen] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">auto</span> nameStr = std::<span class="built_in">string</span>(name);</span><br><span class="line">        m_uniforms.<span class="built_in">try_emplace</span>(nameStr,</span><br><span class="line">                               <span class="built_in">glGetUniformLocation</span>(m_programId, name));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We use <strong>factory pattern</strong> to create shaders, <code>GLShaderProgramFactory</code></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GLShaderProgramFactory.h</span></span><br><span class="line"><span class="keyword">namespace</span> Graphics</span><br><span class="line">&#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">GLShaderProgramFactory</span></span></span><br><span class="line"><span class="class">	&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="function"><span class="keyword">static</span> std::optional&lt;GLShaderProgram&gt; <span class="title">CreateShaderProgram</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="keyword">const</span> std::string&amp; programName,</span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="keyword">const</span> std::vector&lt;ShaderStage&gt;&amp; stages</span></span></span><br><span class="line"><span class="params"><span class="function">		)</span></span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;; <span class="comment">// namespace Graphics</span></span><br></pre></td></tr></table></figure>

<p>Here’s the implementation of <code>CreateShaderProgram</code></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::optional&lt;GLShaderProgram&gt; <span class="title">GLShaderProgramFactory::CreateShaderProgram</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">		<span class="keyword">const</span> std::string&amp; programName, <span class="keyword">const</span> std::vector&lt;ShaderStage&gt;&amp; stages)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Building shader program &quot;</span> &lt;&lt; programName &lt;&lt; std::endl;</span><br><span class="line">    std::vector&lt;<span class="keyword">unsigned</span> <span class="keyword">int</span>&gt; shaderIds;</span><br><span class="line">    <span class="keyword">bool</span> success = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; stage : stages)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> id = <span class="built_in">glCreateShader</span>(TYPE2_GL_ENUM.<span class="built_in">at</span>(stage.m_type));</span><br><span class="line">        shaderIds.<span class="built_in">push_back</span>(id);</span><br><span class="line">        <span class="keyword">auto</span> shaderCode&#123; ResourceManager::<span class="built_in">GetInstance</span>().<span class="built_in">LoadTextFile</span>(stage.m_filePath) &#125;;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">CompileStage</span>(id, shaderCode, stage.m_type))</span><br><span class="line">        &#123;</span><br><span class="line">            success = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!success)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;Shader Compilation failed\n&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> id : shaderIds)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">glDeleteShader</span>(id);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> std::nullopt;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> programId = <span class="built_in">glCreateProgram</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> id : shaderIds)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">glAttachShader</span>(programId, id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">LinkProgram</span>(programId) || !<span class="built_in">ValidateProgram</span>(programId))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> id : shaderIds)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">glDetachShader</span>(programId, id);</span><br><span class="line">            <span class="built_in">glDeleteShader</span>(id);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">glDeleteProgram</span>(programId);</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;Shader Link failed\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> std::nullopt;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> id : shaderIds) &#123;</span><br><span class="line">        <span class="built_in">glDetachShader</span>(programId, id);</span><br><span class="line">        <span class="built_in">glDeleteShader</span>(id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> std::make_optional&lt;GLShaderProgram&gt;(&#123; programName, programId &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The whole process is straightforward:</p>
<ol>
<li>Load shader source code.</li>
<li>Compile shader and check errors.</li>
<li>Attach shader and link program.</li>
<li>Delete the shaders as they’re linked into our program now and no longer necessary.</li>
</ol>
<p>That’s all for today! Next we will dive into model and meshes!.</p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>Link：</strong>
      <a href="https://proton991.github.io/ArkRenderer-Dev-Log-1/" title="ArkRenderer Dev Log 1" target="_blank" rel="external">https://proton991.github.io/ArkRenderer-Dev-Log-1/</a>
    </li>
    
<!--     <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li> -->
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/proton991" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/minions.jpeg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/proton991" target="_blank"><span class="text-dark">Cui Xinyu</span><small class="ml-1x">Farmer</small></a></h3>
        <div>He is lazy...</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    

  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/Ark-VkRender-Dev-Log-0/" title="Ark VkRenderer Dev Log 0"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;Newer</span></a>
    </li>
    
    
    <li class="next">
      <a href="/ArkRenderer-Dev-Log-0/" title="ArkRenderer Dev Log 0"><span>Older&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="Catalogue" role="button">
        <span>[&nbsp;</span><span>Catalogue</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div>
    
  </div>
  </div>
</nav>
  


</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/proton991" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   









</body>
</html>